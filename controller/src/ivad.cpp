#include <Wire.h>

static void writeToIvad(byte address, byte message)
{
  Wire.beginTransmission(address);
  Wire.write(message);
  Wire.endTransmission();
}

static void writeToIvad(byte address, byte message1, byte message2)
{
  Wire.beginTransmission(address);
  Wire.write(message1);
  Wire.write(message2);
  Wire.endTransmission();
}

static void readFromIvad(byte address, byte bytes)
{
  char buf[bytes + 1];
  byte bytesRead = 0;
  Wire.requestFrom(address, bytes);
  while (Wire.available())
  {
    char c = Wire.read();
    buf[bytesRead++] = c;
  }
  buf[bytesRead] = '\0';
}

void IVAD_InitBoard()
{
  writeToIvad(0x46, 0x13, 0x00);
  writeToIvad(0x46, 0x13, 0x00);
  readFromIvad(0x46, 1);
  writeToIvad(0x46, 0x09, 0x00);
  writeToIvad(0x53, 0x33);
  readFromIvad(0x53, 1);
  writeToIvad(0x46, 0x13, 0x0b);
  writeToIvad(0x46, 0x00, 0x00);
  writeToIvad(0x46, 0x08, 0xe4);
  writeToIvad(0x46, 0x12, 0xc9);
  writeToIvad(0x53, 0x00);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x0a);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x14);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x1e);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x28);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x32);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x3c);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x46);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x50);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x5a);
  readFromIvad(0x53, 10);
  writeToIvad(0x46, 0x01, 0x82);
  writeToIvad(0x46, 0x02, 0x82);
  writeToIvad(0x46, 0x03, 0x82);
  writeToIvad(0x46, 0x04, 0xa0);
  writeToIvad(0x46, 0x05, 0xa0);
  writeToIvad(0x46, 0x06, 0xa0);
  writeToIvad(0x46, 0x07, 0xad);
  writeToIvad(0x46, 0x08, 0xe4);
  writeToIvad(0x46, 0x09, 0x3d);
  writeToIvad(0x46, 0x0a, 0x9e);
  writeToIvad(0x46, 0x0b, 0xb4);
  writeToIvad(0x46, 0x0c, 0xc4);
  writeToIvad(0x46, 0x0d, 0x27);
  writeToIvad(0x46, 0x0e, 0xbf);
  writeToIvad(0x46, 0x0f, 0xc0);
  writeToIvad(0x46, 0x10, 0x40);
  writeToIvad(0x46, 0x11, 0x0a);
  writeToIvad(0x46, 0x12, 0x5b);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x53, 0x00);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x10);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x20);
  readFromIvad(0x53, 10);
  writeToIvad(0x53, 0x30);
  readFromIvad(0x53, 10);
  writeToIvad(0x46, 0x11, 0x05);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x46, 0x00, 0x00);
  writeToIvad(0x46, 0x07, 0xb1);
  writeToIvad(0x46, 0x0d, 0x10);
  writeToIvad(0x46, 0x0c, 0xc7);
  writeToIvad(0x46, 0x09, 0x4a);
  writeToIvad(0x46, 0x08, 0xea);
  writeToIvad(0x46, 0x0f, 0xc0);
  writeToIvad(0x46, 0x0b, 0xae);
  writeToIvad(0x46, 0x12, 0x5b);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x46, 0x11, 0x05);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x46, 0x10, 0x40);
  writeToIvad(0x46, 0x06, 0xa0);
  writeToIvad(0x46, 0x05, 0xa0);
  writeToIvad(0x46, 0x04, 0xa0);
  writeToIvad(0x46, 0x03, 0x82);
  writeToIvad(0x46, 0x02, 0x82);
  writeToIvad(0x46, 0x01, 0x82);
  writeToIvad(0x46, 0x11, 0x05);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x46, 0x11, 0x05);
  writeToIvad(0x46, 0x00, 0xff);
  writeToIvad(0x46, 0x10, 0x40);
  writeToIvad(0x46, 0x06, 0xa0);
  writeToIvad(0x46, 0x05, 0xa0);
  writeToIvad(0x46, 0x04, 0xa0);
  writeToIvad(0x46, 0x03, 0x82);
  writeToIvad(0x46, 0x02, 0x82);
  writeToIvad(0x46, 0x01, 0x82);
  writeToIvad(0x46, 0x11, 0x05);
  writeToIvad(0x46, 0x00, 0xff);
}

void IVAD_SetParameter(byte index, byte value)
{
  writeToIvad(0x46, index, value);
}